<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jtzh.mapper.NetGridMemberMapper">
    <resultMap id="BaseResultMap" type="com.jtzh.entity.NetGridMember">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="NetGridMemberID" jdbcType="BIGINT" property="netGridMemberID"/>
        <result column="NetGridID" jdbcType="BIGINT" property="netGridID"/>
        <result column="Name" jdbcType="VARCHAR" property="name"/>
        <result column="Sex" jdbcType="INTEGER" property="sex"/>
        <result column="Ethnicity" jdbcType="VARCHAR" property="ethnicity"/>
        <result column="Politics" jdbcType="VARCHAR" property="politics"/>
        <result column="CertID" jdbcType="VARCHAR" property="certID"/>
        <result column="BirthDate" jdbcType="DATE" property="birthDate"/>
        <result column="Education" jdbcType="VARCHAR" property="education"/>
        <result column="MobileTel" jdbcType="VARCHAR" property="mobileTel"/>
        <result column="FixedTel" jdbcType="VARCHAR" property="fixedTel"/>
        <result column="Position" jdbcType="VARCHAR" property="position"/>
    </resultMap>
    <resultMap id="NetGridMemberVO" type="com.jtzh.vo.netGrid.NetGridMemberVO">
        <id column="NetGridMemberID" jdbcType="BIGINT" property="netGridMemberID"/>
        <result column="FatherNetGridName" jdbcType="VARCHAR" property="fatherNetGridName"/>
        <result column="NetGridName" jdbcType="VARCHAR" property="netGridName"/>
        <result column="Name" jdbcType="VARCHAR" property="name"/>
        <result column="Sex" jdbcType="INTEGER" property="sex"/>
        <result column="EthnicityName" jdbcType="VARCHAR" property="ethnicityName"/>
        <result column="PoliticsTypeName" jdbcType="VARCHAR" property="politicsTypeName"/>
        <result column="CertID" jdbcType="VARCHAR" property="certID"/>
        <result column="BirthDate" jdbcType="VARCHAR" property="birthDate"/>
        <result column="EducationTypeName" jdbcType="VARCHAR" property="educationTypeName"/>
        <result column="MobileTel" jdbcType="VARCHAR" property="mobileTel"/>
        <result column="FixedTel" jdbcType="VARCHAR" property="fixedTel"/>
        <result column="Position" jdbcType="VARCHAR" property="position"/>
    </resultMap>

    <resultMap id="PieCountVO" type="com.jtzh.vo.gis.PieCountVO">
        <result column="NetGridName" jdbcType="VARCHAR" property="name"/>
        <result column="Value" jdbcType="VARCHAR" property="value"/>
    </resultMap>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from TENetGridMember
        where NetGridMemberID = #{netGridMemberID,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.jtzh.entity.NetGridMember" keyProperty="netGridMemberID"
            useGeneratedKeys="true">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into TENetGridMember (NetGridMemberID, NetGridID, Name,
        Sex, Ethnicity, Politics,
        CertID, BirthDate, Education,
        MobileTel, FixedTel, Position
        )
        values (#{netGridMemberID,jdbcType=BIGINT}, #{netGridID,jdbcType=BIGINT}, #{name,jdbcType=VARCHAR},
        #{sex,jdbcType=INTEGER}, #{ethnicity,jdbcType=VARCHAR}, #{politics,jdbcType=VARCHAR},
        #{certID,jdbcType=VARCHAR}, #{birthDate,jdbcType=DATE}, #{education,jdbcType=VARCHAR},
        #{mobileTel,jdbcType=VARCHAR}, #{fixedTel,jdbcType=VARCHAR}, #{position,jdbcType=VARCHAR}
        )
    </insert>
    <update id="updateByPrimaryKey" parameterType="com.jtzh.entity.NetGridMember">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update TENetGridMember
        set NetGridID = #{netGridID,jdbcType=BIGINT},
        Name = #{name,jdbcType=VARCHAR},
        Sex = #{sex,jdbcType=INTEGER},
        Ethnicity = #{ethnicity,jdbcType=VARCHAR},
        Politics = #{politics,jdbcType=VARCHAR},
        CertID = #{certID,jdbcType=VARCHAR},
        BirthDate = #{birthDate,jdbcType=DATE},
        Education = #{education,jdbcType=VARCHAR},
        MobileTel = #{mobileTel,jdbcType=VARCHAR},
        FixedTel = #{fixedTel,jdbcType=VARCHAR},
        Position = #{position,jdbcType=VARCHAR}
        where NetGridMemberID = #{netGridMemberID,jdbcType=BIGINT}
    </update>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select NetGridMemberID, NetGridID, Name, Sex, Ethnicity, Politics, CertID, BirthDate,
        Education, MobileTel, FixedTel, Position
        from TENetGridMember
        where NetGridMemberID = #{netGridMemberID,jdbcType=BIGINT}
    </select>
    <select id="selectAll" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select NetGridMemberID, NetGridID, Name, Sex, Ethnicity, Politics, CertID, BirthDate,
        Education, MobileTel, FixedTel, Position
        from TENetGridMember
    </select>

    <select id="getNetGridMemberQuery" resultMap="NetGridMemberVO">
        SELECT NetGridMemberID,t6.NetGridName FatherNetGridName,t2.NetGridName,
        Name,Sex,EthnicityName,PoliticsTypeName,
        CertID,BirthDate,EducationTypeName,MobileTel,FixedTel,Position
        FROM TENetGridMember t1
        left join TENetGrid t2 on
        t1.NetGridID=t2.NetGridID
        left join TECODEEthnicityType t3 on
        t1.Ethnicity=t3.Ethnicity
        left join TECODEPoliticsType t4 on
        t1.Politics=t4.PoliticsTypeValue
        left join TECODEEducationType t5 on
        t1.Education=t5.Education
        left join TENetGrid t6 on
        t2.FatherNetGridID=t6.NetGridID
        where 1=1
        <if test="name != null and name != ''">
            and Name like CONCAT(CONCAT('%',
            #{name}), '%')
        </if>
        <if test="certID != null and certID != ''">
            and CertID = #{certID}
        </if>
        <if test="netGridID != null and netGridID != 0">
            and t2.FatherNetGridID = #{netGridID}
        </if>
        <if test="isServicePerson != null and isServicePerson == 1">
            and t1.Position = '网格员'
        </if>
        limit #{start}, #{pageSize}
    </select>
    <select id="getNetGridMemberQueryCount" resultType="java.lang.Integer">
        SELECT count(*)
        FROM TENetGridMember t1
        left join TENetGrid t2 on
        t1.NetGridID=t2.NetGridID
        left join TECODEEthnicityType t3 on
        t1.Ethnicity=t3.Ethnicity
        left join TECODEPoliticsType t4 on
        t1.Politics=t4.PoliticsTypeValue
        left join TECODEEducationType t5 on
        t1.Education=t5.Education
        left join TENetGrid t6 on
        t2.FatherNetGridID=t6.NetGridID
        where 1=1
        <if test="name != null and name != ''">
            and Name like CONCAT(CONCAT('%',
            #{name}), '%')
        </if>
        <if test="certID != null and certID != ''">
            and CertID = #{certID}
        </if>
        <if test="isServicePerson != null and isServicePerson == 1">
            and t1.Position = '网格员'
        </if>
        <if test="netGridID != null and netGridID != 0">
            and t2.FatherNetGridID = #{netGridID}
        </if>
    </select>

    <select id="getNetGridMemberDetail" resultMap="NetGridMemberVO">
        SELECT NetGridMemberID,t6.NetGridName FatherNetGridName,t2.NetGridName,
        Name,Sex,EthnicityName,PoliticsTypeName,
        CertID,BirthDate,EducationTypeName,MobileTel,FixedTel,Position
        FROM TENetGridMember t1
        left join TENetGrid t2 on
        t1.NetGridID=t2.NetGridID
        left join TECODEEthnicityType t3 on
        t1.Ethnicity=t3.Ethnicity
        left join TECODEPoliticsType t4 on
        t1.Politics=t4.PoliticsTypeValue
        left join TECODEEducationType t5 on
        t1.Education=t5.Education
        left join TENetGrid t6 on
        t2.FatherNetGridID=t6.NetGridID
        WHERE NetGridMemberID=#{id}
    </select>
    <select id="getNetGridMemberCount" resultMap="PieCountVO">
       select NetGridName,ifnull(tt.value,0) Value from TENetGrid tn left join
(SELECT NetGridName name,count(*)value FROM TENetGridMember t1
left join TENetGrid t2 on
t1.NetGridID=t2.NetGridID
group by NetGridName) tt on tn.NetGridName=tt.name where tn.FatherNetGridID=-1
    </select>
    <select id="getNetGridMemberForOrg" resultType="map">
       select Name,MobileTel,Position,PhotoFilePath,PhotoFileName,PhotoFileSuffix from TENetGridMember
       left join TENetGridMemberPhoto
       on NetGridMemberID=MemberID
       where NetGridID=#{id}
    </select>

    <select id="getNetGridMemberIDByNameAndCertID" resultType="long">
       select NetGridMemberID from TENetGridMember
       where Name=#{name}
        <if test="certID != null and certID != ''">
            and CertID=#{certID}
        </if>

    </select>
    <select id="getNetGridMemberByNetGridID" resultMap="NetGridMemberVO">
        SELECT NetGridMemberID,t6.NetGridName FatherNetGridName,t2.NetGridName,
        Name,Sex,EthnicityName,PoliticsTypeName,
        CertID,BirthDate,EducationTypeName,MobileTel,FixedTel,Position
        FROM TENetGridMember t1
        left join TENetGrid t2 on
        t1.NetGridID=t2.NetGridID
        left join TECODEEthnicityType t3 on
        t1.Ethnicity=t3.Ethnicity
        left join TECODEPoliticsType t4 on
        t1.Politics=t4.PoliticsTypeValue
        left join TECODEEducationType t5 on
        t1.Education=t5.Education
        left join TENetGrid t6 on
        t2.FatherNetGridID=t6.NetGridID
        WHERE t2.NetGridID=#{id} and t1.Position='网格员'
    </select>


    <select id="reporter"  resultType="java.util.Map">
                 SELECT  COUNT(1) as no , NetGridMemberVO.name as name from  (  select DisputeEventID, EventName, EventDate, EventPlace,
                                 t4.NetGridID,
                                    NetGridName,EventStatus,EventStatusName,t7.name
                                    from TEDisputeEvent t1

                                    left join TENetGrid t4 on t1.NetGridID=t4.NetGridID
                                 left join TECODEEventStatusType t5 on t1.EventStatus=t5.EventStatusType
                                    left join TRDisputeEventDistribute t6 on t1.DisputeEventID=t6.EventID
                                            left join  TENetGridMember t7  ON t7.NetGridID=t4.NetGridID 	and t7.Position="网格员"
                                    where 1=1 and t1.EventStatus='01' or t1.EventStatus='03' or t1.EventStatus='04'
                                group by DisputeEventID
                                order by EventDate desc ) NetGridMemberVO
                               GROUP BY name
                                     ORDER BY no desc

    </select>
    <select id="reporterRank" resultType="com.jtzh.vo.netGrid.NetGridMemberVO">
     SELECT t7.`Name`,t7.NetGridMemberID
                   FROM
                    TENetGrid t4
                    LEFT JOIN TENetGridMember t7 ON t7.NetGridID = t4.NetGridID
                    AND t7.Position = "网格员"
                WHERE
                    1 = 1

                GROUP BY
               t7.NetGridMemberID desc
								limit 0,5


    </select>
    <select id="Achievements" resultType="com.jtzh.vo.netGrid.NetGridMemberVO">


          SELECT t1.name  ,count(1) no FROM tenetgridmember t1 LEFT JOIN

					tenetgridevent t2 on t1.NetGridID=t2.NetGridID and t1.Position='网格长'
					LEFT JOIN  tenetgrid t3 on t3.NetGridID=t1.NetGridID GROUP BY t1.`Name`
					order by  no  desc
					LIMIT 0,6
    </select>

</mapper>