<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jtzh.mapper.SpecialServedPersonMapper">
    <resultMap id="BaseResultMap" type="com.jtzh.entity.SpecialServedPerson">
        <!-- WARNING - @mbg.generated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        <id column="SpecialServedPersonID" jdbcType="INTEGER" property="specialServedPersonID"/>
        <result column="SpecialPopulationTypeValue" jdbcType="VARCHAR"
                property="specialPopulationTypeValue"/>
        <result column="ServedPersonID" jdbcType="BIGINT" property="servedPersonID"/>
    </resultMap>
    <resultMap type="com.jtzh.vo.app.SpecialPopulationForTypeAndNetGrid"
               id="SpecialPopulationForTypeAndNetGrid">
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="Sex" jdbcType="CHAR" property="sex"/>
        <result column="Name" jdbcType="VARCHAR" property="name"/>
        <result column="BirthDate" jdbcType="DATE" property="birthDate"/>
        <result column="Politics" jdbcType="CHAR" property="politics"/>
        <result column="MaritalStatus" jdbcType="CHAR" property="maritalStatus"/>
        <result column="SpecialPopulationTypeValue" jdbcType="VARCHAR"
                property="specialPopulationTypeValue"/>
        <result column="CareerType" jdbcType="CHAR" property="careerType"/>
        <result column="PresentAddressDetail" jdbcType="VARCHAR"
                property="presentAddressDetail"/>
        <result column="MobileTel" jdbcType="VARCHAR" property="mobileTel"/>
        <result column="NetGridName" jdbcType="VARCHAR" property="netGridName"/>
    </resultMap>
    <resultMap type="com.jtzh.vo.served.SpecialPersonCountVO" id="SpecialPersonCountVO">
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="emancipist" jdbcType="INTEGER" property="emancipist"/>
        <result column="community" jdbcType="INTEGER" property="community"/>
        <result column="psychotic" jdbcType="INTEGER" property="psychotic"/>
        <result column="drug" jdbcType="INTEGER" property="drug"/>
        <result column="AIDS" jdbcType="INTEGER" property="AIDS"/>
    </resultMap>

    <resultMap type="com.jtzh.vo.served.SpecialPersonCountByTypeVO"
               id="SpecialPersonCountByTypeVO">
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="yc" jdbcType="INTEGER" property="yc"/>
        <result column="hh" jdbcType="INTEGER" property="hh"/>
        <result column="tl" jdbcType="INTEGER" property="tl"/>
        <result column="ms" jdbcType="INTEGER" property="ms"/>
        <result column="md" jdbcType="INTEGER" property="md"/>
        <result column="xl" jdbcType="INTEGER" property="xl"/>
        <result column="mg" jdbcType="INTEGER" property="mg"/>
        <result column="pc" jdbcType="INTEGER" property="pc"/>
        <result column="sg" jdbcType="INTEGER" property="sg"/>
        <result column="lt" jdbcType="INTEGER" property="lt"/>
    </resultMap>

    <resultMap type="com.jtzh.vo.served.SpecialPersonPieVO" id="SpecialPersonPieVO">
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="value" jdbcType="INTEGER" property="value"/>
    </resultMap>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!-- WARNING - @mbg.generated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        delete from TRSpecialServedPerson
        where SpecialServedPersonID =
        #{specialServedPersonID,jdbcType=INTEGER}
    </delete>
    <insert id="insert" parameterType="com.jtzh.entity.SpecialServedPerson">
        <!-- WARNING - @mbg.generated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        insert into TRSpecialServedPerson (SpecialServedPersonID,
        SpecialPopulationTypeValue,
        ServedPersonID)
        values
        (#{specialServedPersonID,jdbcType=INTEGER},
        #{specialPopulationTypeValue,jdbcType=VARCHAR},
        #{servedPersonID,jdbcType=BIGINT})
    </insert>
    <update id="updateByPrimaryKey" parameterType="com.jtzh.entity.SpecialServedPerson">
        <!-- WARNING - @mbg.generated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        update TRSpecialServedPerson
        set SpecialPopulationTypeValue =
        #{specialPopulationTypeValue,jdbcType=VARCHAR},
        ServedPersonID =
        #{servedPersonID,jdbcType=BIGINT}
        where SpecialServedPersonID =
        #{specialServedPersonID,jdbcType=INTEGER}
    </update>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer"
            resultMap="BaseResultMap">
        <!-- WARNING - @mbg.generated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        select SpecialServedPersonID, SpecialPopulationTypeValue,
        ServedPersonID
        from TRSpecialServedPerson
        where SpecialServedPersonID =
        #{specialServedPersonID,jdbcType=INTEGER}
    </select>
    <select id="selectAll" resultMap="BaseResultMap">
        <!-- WARNING - @mbg.generated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        select SpecialServedPersonID, SpecialPopulationTypeValue,
        ServedPersonID
        from TRSpecialServedPerson
    </select>
    <select id="query" resultMap="BaseResultMap">
        <!-- WARNING - @mbg.generated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        select SpecialServedPersonID, SpecialPopulationTypeValue,
        ServedPersonID
        from TRSpecialServedPerson
        where 1=1
        <if test="specialTypeValue != null and specialTypeValue != '' ">
            and SpecialPopulationTypeValue = #{specialTypeValue}
        </if>
        <if test="servedPersonID != null and specialTypeValue != 0 ">
            and ServedPersonID = #{servedPersonID}
        </if>
    </select>
    <select id="select" resultMap="SpecialPopulationForTypeAndNetGrid">
		SELECT
		t1.name,t1.sex,t1.BirthDate,t1.MaritalStatus,t1.Politics,t2.SpecialPopulationTypeValue,t4.CareerType,t1.PresentAddressDetail,t1.MobileTel,t3.NetGridName
		FROM MSMIS_DB.TEServedPersonBasic t1
		left join TRSpecialServedPerson t2
		on
		t1.ServedPersonID=t2.SpecialServedPersonID
		left join TENetGrid t3 on
		t1.NetGridID=t3.NetGridID
		left join TECODECareerType t4 on
		t1.CareerType=t4.CareerType
		where
		t2.SpecialPopulationTypeValue=#{specialPopulationTypeValue}
		and
		t3.NetGridName=#{netGridName}
		limit #{start}, #{pageSize}
	</select>
    <select id="getQueryCount" resultType="int">
		SELECT
		count(*)
		FROM
		MSMIS_DB.TEServedPersonBasic t1
		left join TRSpecialServedPerson t2 on
		t1.ServedPersonID=t2.SpecialServedPersonID
		left join TENetGrid t3 on
		t1.NetGridID=t3.NetGridID
		left join TECODECareerType t4 on
		t1.CareerType=t4.CareerType
		where
		t2.SpecialPopulationTypeValue=#{specialPopulationTypeValue} and
		t3.NetGridName=#{netGridName};
	</select>
    <select id="getSpecialPersonCount" resultMap="SpecialPersonCountVO">
		SELECT
		t3.NetGridName name,sum(case when t1.SpecialPopulationTypeValue='01'
		then 1
		else 0 end) emancipist,
		sum(case when
		t1.SpecialPopulationTypeValue='02'
		then 1 else 0 end) community,
		sum(case when
		t1.SpecialPopulationTypeValue='03' then 1 else 0
		end)
		psychotic
		FROM TRSpecialServedPerson t1
		left join
		TEServedPersonBasic t2 on t1.ServedPersonID=t2.ServedPersonID
		left join
		TENetGrid t3 on t2.NetGridID=t3.NetGridID
		group by t3.NetGridName;
		/*SELECT
		t3.NetGridName name,sum(case when t1.SpecialPopulationTypeValue='01'
		then 1
		else 0 end) emancipist,
		sum(case when
		t1.SpecialPopulationTypeValue='02'
		then 1 else 0 end) community,
		sum(case when
		t1.SpecialPopulationTypeValue='03' then 1 else 0
		end)
		psychotic,
		sum(case
		when t1.SpecialPopulationTypeValue='04' then 1 else
		0 end) drug,
		sum(case when t1.SpecialPopulationTypeValue='05' then 1
		else 0
		end) AIDS
		FROM TRSpecialServedPerson t1
		left join
		TEServedPersonBasic t2 on t1.ServedPersonID=t2.ServedPersonID
		left join
		TENetGrid t3 on t2.NetGridID=t3.NetGridID
		group by t3.NetGridName;*/
	</select>


    <select id="getSpecialPersonCountByType" resultMap="SpecialPersonCountByTypeVO">
		select
		t4.SpecialPopulationTypeName name,
		sum(case when t3.NetGridID=1 then 1
		else
		0 end) yc,
		sum(case when t3.NetGridID=2 then 1 else 0 end) hh,
		sum(case
		when t3.NetGridID=3 then 1 else 0 end) tl,
		sum(case when
		t3.NetGridID=4
		then 1 else 0 end) ms,
		sum(case when t3.NetGridID=5 then
		1 else 0 end)
		md,
		sum(case when t3.NetGridID=6 then 1 else 0 end) xl,
		sum(case when
		t3.NetGridID=7 then 1 else 0 end) mg,
		sum(case when
		t3.NetGridID=8 then
		1 else 0 end) pc,
		sum(case when t3.NetGridID=9 then
		1 else 0 end) sg,
		sum(case when t3.NetGridID=10 then 1 else 0 end) lt
		from
		TRSpecialServedPerson t1
		left join TEServedPersonBasic t2
		on
		t1.ServedPersonID=t2.ServedPersonID
		left join TENetGrid t3
		on
		t2.NetGridID=t3.NetGridID
		left join TECODESpecialPopulationType t4
		on
		t1.SpecialPopulationTypeValue=t4.SpecialPopulationTypeValue
		group by
		t4.SpecialPopulationTypeName;
	</select>
    <select id="getSpecialPersonPieCount" resultMap="SpecialPersonPieVO">
		SELECT
		t.NetGridName name,
		IFNULL(ta.value, 0) value
		FROM
		TENetGrid t
		LEFT JOIN
		(SELECT
		t2.NetGridName NAME,
		COUNT(*) VALUE
		FROM
		TEServedPersonBasic t1
		LEFT JOIN
		TENetGrid t2
		ON t1.NetGridID = t2.NetGridID
		LEFT JOIN
		TRSpecialServedPerson t3
		ON t1.ServedPersonID = t3.ServedPersonID
		WHERE
		t3.SpecialPopulationTypeValue = #{type}
		GROUP BY t2.NetGridName) ta
		ON
		t.NetGridName = ta.name
		 where t.FatherNetGridID=-1

	</select>


</mapper>